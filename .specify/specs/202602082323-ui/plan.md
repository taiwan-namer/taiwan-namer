# 技術計畫 (Technical Plan)

## Tech Stack

### 核心框架
- **Next.js 15** (App Router)：提供 SSR/SSG、API Routes、優化效能
- **TypeScript 5**：嚴格型別檢查，禁止使用 `any`
- **React 19**：最新穩定版

### 樣式與 UI
- **Tailwind CSS**：原子化 CSS 框架，快速開發響應式設計
- **shadcn/ui**：基於 Radix UI 的可存取性元件庫
- **Lucide React**：圖示庫

### 狀態管理
- **Zustand**：輕量狀態管理（用於全域 UI 狀態）
- **React Context**：局部狀態共享（主題、使用者偏好）

### 資料處理
- **AI SDK (Vercel AI)**：OpenAI API 整合
- **localStorage**：瀏覽器端收藏功能 (R2.2)
- **JSON 檔案**：伺服器端事件記錄 (R5)

### 開發工具
- **ESLint** + **Prettier**：程式碼檢查與格式化
- **Jest** + **React Testing Library**：單元測試
- **Playwright**：E2E 測試
- **Husky** + **lint-staged**：Git hooks

### 部署與監控
- **Vercel**：部署平台
- **Vercel Analytics**：基礎分析事件追蹤 (R5.1)

## Architecture

### 目錄結構 (Feature-based)
```
src/
├── app/                    # Next.js App Router
│   ├── (marketing)/       # 行銷頁面群組
│   │   ├── page.tsx       # 首頁 (R1.1, R1.2)
│   │   ├── blog/          # 部落格 (R4.2)
│   │   └── about/         # 關於我們 (R4.3)
│   ├── (result)/          # 結果頁面群組
│   │   ├── page.tsx       # 命名結果頁
│   │   └── share/         # 分享頁面 (R2.3)
│   ├── go/                # 聯盟跳轉端點 (R3.1)
│   │   └── [vendor]/      # 動態廠商路由
│   ├── admin/             # 管理後台 (R5.2)
│   │   └── clicks/        # 點擊統計頁面
│   └── api/               # API Routes
│       ├── generate/      # AI 命名生成
│       └── events/        # 事件記錄
├── components/            # 共用元件
│   ├── ui/               # shadcn/ui 基礎元件
│   ├── domain/           # 網域相關元件 (R1.3, R2)
│   ├── layout/           # 佈局元件
│   └── marketing/        # 行銷區塊元件 (R4.1)
├── lib/                  # 工具函式庫
│   ├── ai/              # AI 提示詞與處理
│   ├── vendors/         # 註冊商邏輯 (R3.4)
│   ├── events/          # 事件記錄工具 (R5.1)
│   └── constants/       # 常數定義
├── types/               # TypeScript 型別定義
├── styles/              # 全域樣式
└── data/               # 靜態資料
    ├── blog/           # 部落格文章 (R4.2)
    └── events.json     # 事件記錄檔案 (R5)
```

### 資料流架構
1. **AI 命名生成流程** (R1)
   ```
   使用者輸入 → API Route (/api/generate) → OpenAI API → 解析回應 → 前端顯示
   ```

2. **聯盟跳轉流程** (R3)
   ```
   點擊按鈕 → /go/[vendor] API Route → 記錄事件 → 302 重定向至外部網站
   ```

3. **事件記錄系統** (R5)
   ```
   前端互動 → events.logEvent() → API Route (/api/events) → 寫入 events.json
   ```

4. **收藏功能** (R2.2)
   ```
   點擊愛心 → Zustand store 更新 → localStorage 同步 → UI 狀態更新
   ```

## Implementation Plan

### Phase 1: 基礎架構與核心命名 (預計 3-5 天)
**目標**：建立專案基礎，實現 AI 命名核心功能

#### 任務清單：
1. **專案初始化** (R1)
   - [ ] 建立 Next.js 專案，配置 TypeScript、Tailwind CSS、ESLint
   - [ ] 設定專案結構與基本佈局元件
   - [ ] 建立基本頁面路由：(marketing)/page.tsx (首頁)

2. **AI 命名生成 API** (R1.1, R1.2)
   - [ ] 建立 `/api/generate` API Route
   - [ ] 整合 OpenAI API，設計提示詞模板
   - [ ] 實作關鍵字處理：多關鍵字合併 (Clarify)
   - [ ] 實作預設關鍵字回退邏輯 (珍珠奶茶、好運)

3. **首頁 UI 與互動** (R1.1, R1.3, R1.4)
   - [ ] 設計首頁輸入表單與「開始算命」按鈕
   - [ ] 建立 DomainCard 元件，顯示：
     - 網域名稱與後綴
     - 中文名稱
     - 寓意解釋
     - 靜態參考價格 (NT$ 顯示)
   - [ ] 實作網域排序邏輯：.com → .tw → .io → .ai (Clarify)

4. **結果頁面** (R1)
   - [ ] 建立 (result)/page.tsx 顯示生成結果
   - [ ] 實作預設範例顯示 (5 組結果) (Clarify)

### Phase 2: 網域互動功能 (預計 2-3 天)
**目標**：實現使用者與網域建議的互動功能

#### 任務清單：
1. **網域操作功能** (R2.1, R2.2)
   - [ ] 實作「一鍵複製」功能 (使用 navigator.clipboard)
   - [ ] 建立收藏系統：
     - Zustand store 管理收藏狀態
     - localStorage 持久化
     - 愛心圖示切換 (空心/實心)
   - [ ] 在結果頁下方實作收藏彈出區塊 (Clarify)

2. **分享功能** (R2.3)
   - [ ] 建立 `/share/[id]` 頁面，還原生成結果
   - [ ] 實作分享連結生成 (包含參數)
   - [ ] 在 DomainCard 添加分享按鈕

3. **註冊商按鈕** (R2.4)
   - [ ] 根據 TLD 顯示對應註冊商按鈕
   - [ ] 國際後綴顯示 Namecheap，.tw 顯示台灣註冊商 (Clarify)

### Phase 3: 聯盟導流與追蹤 (預計 2-3 天)
**目標**：建立可追蹤的聯盟行銷管道

#### 任務清單：
1. **跳轉端點實作** (R3.1, R3.2)
   - [ ] 建立 `/go/[vendor]` 動態路由
   - [ ] 實作 302 重定向至外部網站
   - [ ] 添加聯盟追蹤參數 (固定 affiliate 參數) (Clarify)

2. **事件記錄系統** (R3.3, R5.1)
   - [ ] 建立事件記錄工具函式 (lib/events)
   - [ ] 建立 `/api/events` API Route 寫入 events.json
   - [ ] 在前端關鍵互動點埋設事件：
     - generate_domain (命名生成)
     - copy_domain (複製網域)
     - favorite_domain (收藏網域)
     - outbound_click_[vendor] (外部點擊)

3. **智慧按鈕顯示** (R3.4)
   - [ ] 建立廠商邏輯工具 (lib/vendors)
   - [ ] .tw 網域不顯示 Namecheap 選項

### Phase 4: 內容與靜態頁面 (預計 2-3 天)
**目標**：建立產品內容與合規頁面

#### 任務清單：
1. **架站主機推廣** (R4.1)
   - [ ] 建立 MarketingPromotion 元件
   - [ ] 在結果頁底部固定顯示 Bluehost 推薦區塊
   - [ ] 實作 CTA 按鈕與事件記錄 (outbound_click_bluehost)

2. **部落格系統** (R4.2)
   - [ ] 建立 `/blog` 目錄結構
   - [ ] 建立至少 3 篇靜態文章 (MDX 或直接 TSX)
   - [ ] 實作文章列表與詳細頁面

3. **靜態頁面** (R4.3)
   - [ ] 建立「關於我們」頁面
   - [ ] 建立「聯絡我們」頁面 (表單或聯絡資訊)
   - [ ] 建立「隱私權政策」頁面
   - [ ] 建立「服務條款」頁面

### Phase 5: 數據管理後台 (預計 2-3 天)
**目標**：建立管理員數據檢視介面

#### 任務清單：
1. **後台頁面** (R5.2, AC3.1, AC3.2)
   - [ ] 建立 `/admin/clicks` 頁面
   - [ ] 實作密碼保護 (基礎 HTTP 認證或簡單密碼檢查)
   - [ ] 讀取 events.json 顯示數據：
     - 摘要卡片：總生成次數、各廠商點擊總數
     - 表格：最近 50 筆詳細記錄

2. **數據處理邏輯**
   - [ ] 建立數據聚合工具函式
   - [ ] 實作分頁或滾動載入

### Phase 6: 測試與優化 (預計 2-3 天)
**目標**：確保產品品質與效能

#### 任務清單：
1. **單元測試**
   - [ ] 測試工具函式 (lib/ 目錄)
   - [ ] 測試元件互動邏輯

2. **E2E 測試**
   - [ ] 測試核心流程：輸入 → 生成 → 操作
   - [ ] 測試聯盟跳轉流程
   - [ ] 測試後台數據顯示

3. **效能優化**
   - [ ] 檢查 Core Web Vitals
   - [ ] 圖片優化 (使用 next/image)
   - [ ] 實作 Code Splitting

4. **部署與監控**
   - [ ] 設定 Vercel 部署
   - [ ] 配置環境變數
   - [ ] 設定基礎分析

## 技術決策與注意事項

### 1. AI 回應格式規範
- 必須定義嚴格的 JSON 回應格式，確保前端能正確解析
- 包含錯誤處理與重試機制

### 2. 事件記錄安全
- events.json 應有備份機制
- 後台存取需有基本保護
- 考慮事件記錄上限，避免檔案過大

### 3. 聯盟連結驗證
- 定期檢查聯盟連結有效性
- 考慮建立連結健康檢查機制

### 4. 本地儲存相容性
- 收藏功能需處理 localStorage 不可用的情況
- 提供適當的錯誤提示

### 5. 響應式設計
- 確保所有元件在行動裝置上正常顯示
- 測試不同螢幕尺寸的佈局

## 風險與緩解

### 高風險項目：
1. **AI 回應不穩定**
   - 緩解：設計嚴格的提示詞，實作回應驗證與重試

2. **聯盟連結失效**
   - 緩解：定期檢查連結，提供備用註冊商選項

3. **事件記錄檔案過大**
   - 緩解：實作日誌輪替，或考慮輕量資料庫方案

### 依賴項目：
1. **OpenAI API 配額與成本**
2. **合作廠商聯盟計畫穩定性**
3. **Vercel 部署限制 (Serverless Function 時長)**

## 驗收檢查清單

### 核心功能 (必須完成)
- [ ] 首頁輸入關鍵字可生成網域建議 (R1.1)
- [ ] 未輸入時顯示預設範例結果 (R1.2)
- [ ] 網域卡片顯示完整資訊 (R1.3)
- [ ] 網域正確排序 (R1.4)
- [ ] 複製功能正常 (R2.1)
- [ ] 收藏功能正常 (R2.2)
- [ ] 分享連結可還原結果 (R2.3)
- [ ] 註冊商按鈕正確導向 (R2.4, R3)

### 商業功能 (必須完成)
- [ ] 聯盟跳轉記錄事件 (R3.1-R3.3)
- [ ] .tw 不顯示 Namecheap (R3.4)
- [ ] Bluehost 推廣區塊正常 (R4.1)
- [ ] 部落格文章可訪問 (R4.2)
- [ ] 靜態頁面完整 (R4.3)
- [ ] 後台數據可檢視 (R5.2)

### 品質要求 (必須完成)
- [ ] TypeScript 無 any 類型
- [ ] ESLint 檢查通過
- [ ] 基本測試覆蓋率達 80%
- [ ] 行動裝置響應式正常
- [ ] 部署後功能正常

---

**預計總工時**：13-20 人日  
**優先順序**：Phase 1 → Phase 2 → Phase 3 → Phase 4 → Phase 5 → Phase 6  
**關鍵路徑**：AI 生成功能 → 聯盟跳轉 → 事件記錄 → 後台顯示  

此計畫嚴格遵循 Spec 條目，所有功能均對應到 R1-R5 需求，不新增未定義功能。若有規格不足之處，將在開發過程中明確標記並尋求澄清。